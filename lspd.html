<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸš” LSPD Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±Ø·Ø© ğŸš”</title>
  <style>
    * { box-sizing: border-box; font-family: "Segoe UI", Tahoma, Arial, sans-serif; }
    body { margin: 0; height: 100vh; background: linear-gradient(135deg, #1a0033, #0a1626); color: white; overflow: hidden; }
    .overlay { position: fixed; inset: 0; background: radial-gradient(circle at top, rgba(255,0,98,0.15), transparent 60%); z-index: 0; }
    .hidden { display: none !important; }
    .login, .dashboard, .view, .admin-panel { position: relative; z-index: 1; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px; padding: 20px; }
    
    .login h2, .dashboard h1, .view h2 { 
      margin: 0; font-size: 2.5em; 
      background: linear-gradient(45deg, #ff0080, #00d4ff, #ff6b00);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
      background-clip: text; 
    }

    .login input, .admin-panel input, .admin-panel select, .admin-panel textarea { 
      width: 300px; max-width: 90vw; padding: 15px; border-radius: 12px; 
      border: 2px solid rgba(255,255,255,0.1); outline: none; 
      background: rgba(255,255,255,0.1); color: white; font-size: 16px; 
      backdrop-filter: blur(10px); transition: all 0.3s ease; 
    }

    input:focus, select:focus, textarea:focus { border-color: #ff0080; box-shadow: 0 0 20px rgba(255,0,128,0.4); }
    .login input::placeholder, .admin-panel input::placeholder { color: rgba(255,255,255,0.7); }

    button { padding: 15px 30px; border-radius: 12px; border: none; cursor: pointer; 
      background: linear-gradient(45deg, rgba(255,0,128,0.5), rgba(0,212,255,0.3)); 
      color: white; font-size: 16px; font-weight: 600; transition: all 0.3s ease; 
      backdrop-filter: blur(12px); box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
    }

    button:hover { background: linear-gradient(45deg, rgba(255,0,128,0.8), rgba(0,212,255,0.6)); 
      transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255,0,128,0.4); 
    }

    .admin-btn { background: linear-gradient(45deg, rgba(255,107,107,0.6), rgba(255,107,107,0.4)) !important; }
    .admin-btn:hover { background: linear-gradient(45deg, rgba(255,107,107,0.9), rgba(255,107,107,0.7)) !important; }
    .master-btn { background: linear-gradient(45deg, rgba(255,215,0,0.7), rgba(255,215,0,0.5)) !important; }
    .send-btn { background: linear-gradient(45deg, rgba(0,255,127,0.7), rgba(0,255,127,0.5)) !important; }

    .menu { display: flex; flex-direction: column; gap: 25px; max-width: 350px; width: 90vw; }
    .card { width: 100%; padding: 25px; backdrop-filter: blur(15px); background: rgba(255,255,255,0.08); 
      border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; text-align: center; 
      font-size: 18px; font-weight: 500; transition: all 0.3s ease; 
    }
    .card:hover { background: rgba(255,255,255,0.12); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.4); }

    #error { color: #ff6b6b; font-weight: 500; min-height: 20px; text-align: center; }
    .user-info { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 20px; font-size: 14px; }
    .back-btn { position: absolute; top: 20px; left: 20px; padding: 10px 20px !important; font-size: 14px !important; }

    /* View1 - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª */
    .chat-container { display: flex; height: 85vh; width: 95vw; max-width: 1200px; gap: 20px; }
    .chat-main { flex: 2; background: rgba(0,0,0,0.4); border-radius: 16px; padding: 20px; overflow: hidden; display: flex; flex-direction: column; }
    .chat-messages { flex: 1; overflow-y: auto; margin-bottom: 15px; padding-right: 10px; }
    .chat-input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #ff0080; background: rgba(255,255,255,0.1); color: white; resize: none; margin-bottom: 10px; }
    .message { margin: 10px 0; padding: 12px; border-radius: 12px; backdrop-filter: blur(10px); }
    .message.admin { background: rgba(255,0,128,0.3); border-left: 4px solid #ff0080; }
    .message.user { background: rgba(0,212,255,0.3); border-left: 4px solid #00d4ff; }

    .cases-sidebar { flex: 1; background: rgba(0,0,0,0.6); border-radius: 16px; padding: 20px; height: 85vh; overflow-y: auto; }
    .case-item { background: rgba(255,255,255,0.1); margin: 10px 0; padding: 15px; border-radius: 12px; border-right: 4px solid #ff6b00; }

    /* View2 - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙØ±Ø§Ø¯ */
    .table-container { width: 95vw; max-width: 1000px; background: rgba(0,0,0,0.4); border-radius: 16px; padding: 20px; height: 85vh; overflow-y: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
    th { background: rgba(255,0,128,0.3); }
    .points-btn { background: #00ff7f; color: black; font-weight: bold; padding: 8px 15px; border-radius: 8px; cursor: pointer; border: none; }

    /* View3 - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ */
    .high-commands { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; width: 95vw; max-width: 1200px; height: 85vh; }
    .command-box { background: rgba(0,0,0,0.6); border-radius: 16px; padding: 25px; height: 300px; overflow-y: auto; border-top: 4px solid #ffd700; }

    .admin-panel { max-width: 500px; text-align: center; gap: 25px; }
    .ranks-display { background: rgba(0,0,0,0.4); padding: 20px; border-radius: 12px; max-height: 200px; overflow-y: auto; width: 100%; text-align: right; }
    .rank-item { padding: 8px; margin: 5px 0; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 14px; }
    textarea { resize: vertical; min-height: 100px; }
    .change-master { background: rgba(255,215,0,0.3); border: 2px solid #ffd700; color: #ffd700; font-weight: bold; }

    @media (max-width: 768px) { 
      .chat-container { flex-direction: column; height: 90vh; } 
      .cases-sidebar, .chat-main { height: 45vh; } 
    }
  </style>
</head>
<body>
  <div class="overlay"></div>

  <!-- LOGIN -->
  <div class="login" id="loginBox">
    <h2>ğŸš” LSPD Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±Ø·Ø© ğŸš”</h2>
    <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" autocomplete="off">
    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="off">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    <p id="error"></p>
  </div>

  <!-- ADMIN PANEL -->
  <div class="admin-panel hidden" id="adminPanel">
    <button class="back-btn admin-btn" onclick="backToLogin()">â† Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¯Ø®ÙˆÙ„</button>
    <h2>âš™ï¸ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h2>
    
    <div style="display: flex; gap: 10px; width: 100%; flex-wrap: wrap;">
      <input type="text" id="newUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
      <input type="password" id="newPassword" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù…ÙˆØ­Ø¯Ø©">
      <input type="text" id="newRank" placeholder="Ø§Ù„Ø±ØªØ¨Ø© (Minister...)">
      <button onclick="addUser()">â• Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨</button>
    </div>
    
    <textarea id="allUsers" placeholder='JSON Ù…Ø«Ø§Ù„:
[
  {"username":"user1","password":"pass123","rank":"Minister","access":["view1","view2","view3"]},
  {"username":"user2","password":"pass123","rank":"Colonel","access":["view1","view2"]}
]'></textarea>
    
    <div style="display: flex; gap: 10px; flex-wrap: wrap; width: 100%;">
      <button onclick="loadUsers()">ğŸ“‹ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</button>
      <button onclick="clearAllUsers()" class="admin-btn">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      <button onclick="showAllUsers()" class="admin-btn">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
    </div>

    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 12px; border: 2px solid #ffd700; width: 100%;">
      <h3 style="color: #ffd700; margin: 0 0 10px 0;">ğŸ”‘ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
      <div style="display: flex; gap: 10px; width: 100%; flex-wrap: wrap;">
        <input type="password" id="currentMasterPass" placeholder="Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©">
        <input type="password" id="newMasterPass" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©">
        <button onclick="changeMasterPassword()" class="master-btn change-master">âœ… ØªØ­Ø¯ÙŠØ«</button>
      </div>
      <small style="color: #ffd700; font-size: 12px;">Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span id="currentMasterDisplay">******</span></small>
    </div>
    
    <div class="ranks-display" id="ranksDisplay">
      <strong>Ø§Ù„Ø±ØªØ¨ Ø§Ù„Ù…ØªÙˆÙØ±Ø©:</strong><br>
      <div id="currentRanks">Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨" Ù„Ù„Ø¨Ø¯Ø¡</div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div class="dashboard hidden" id="dashboard">
    <div class="user-info" id="userInfo"></div>
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
    <div class="menu">
      <button class="card" onclick="openView('view1')">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª<br><small>Ø§Ù„Ø´Ø§Øª + Ø§Ù„Ø­Ø§Ù„Ø§Øª</small></button>
      <button class="card" onclick="openView('view2')">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙØ±Ø§Ø¯<br><small>Ø§Ù„Ø¬Ø¯ÙˆÙ„ + Ø§Ù„Ù†Ù‚Ø§Ø·</small></button>
      <button class="card" onclick="openView('view3')">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§<br><small>Ù…Ù‡Ø§Ù… Ø³Ø±ÙŠØ© + ØªÙ‚Ø§Ø±ÙŠØ±</small></button>
    </div>
  </div>

  <!-- VIEW 1: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª -->
  <div class="view hidden" id="view1">
    <button class="back-btn" onclick="back()">â† Ø±Ø¬ÙˆØ¹</button>
    <h2>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª</h2>
    <div class="chat-container">
      <div class="chat-main">
        <div class="chat-messages" id="chatMessages"></div>
        <textarea class="chat-input" id="chatInput" placeholder="Ø§ÙƒØªØ¨ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© Ù‡Ù†Ø§... (Ø§Ø¶ØºØ· Enter Ø£Ùˆ Ø¥Ø±Ø³Ø§Ù„)" rows="3"></textarea>
        <button class="send-btn" onclick="sendMessage()" style="width:100%;">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
      </div>
      <div class="cases-sidebar">
        <h3>ğŸ“‚ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
        <div id="casesList"></div>
      </div>
    </div>
  </div>

  <!-- VIEW 2: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙØ±Ø§Ø¯ -->
  <div class="view hidden" id="view2">
    <button class="back-btn" onclick="back()">â† Ø±Ø¬ÙˆØ¹</button>
    <h2>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙØ±Ø§Ø¯</h2>
    <div class="table-container">
      <table>
        <thead>
          <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±ØªØ¨Ø©</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>
        </thead>
        <tbody id="officersTable"></tbody>
      </table>
    </div>
  </div>

  <!-- VIEW 3: Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ -->
  <div class="view hidden" id="view3">
    <button class="back-btn" onclick="back()">â† Ø±Ø¬ÙˆØ¹</button>
    <h2>âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù„ÙŠØ§</h2>
    <div class="high-commands">
      <div class="command-box">
        <h3>ğŸ”’ Ù…Ù†Ø§Ù‚Ø´Ø§Øª Ø³Ø±ÙŠØ©</h3>
        <div id="secretChat">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§Ù‚Ø´Ø§Øª Ø³Ø±ÙŠØ©</div>
        <textarea id="secretInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ©..." style="width:100%; height:80px; margin-top:10px;"></textarea>
        <button onclick="addSecretMessage()" style="width:100%; margin-top:10px;">ğŸ”’ Ø¥Ø±Ø³Ø§Ù„ Ø³Ø±ÙŠ</button>
      </div>
      <div class="command-box">
        <h3>ğŸ¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©</h3>
        <div id="urgentTasks">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¹Ø§Ø¬Ù„Ø©</div>
        <input id="newTask" placeholder="Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©..." style="width:100%; margin-top:10px;">
        <button onclick="addTask()" style="width:100%; margin-top:10px;">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
      </div>
      <div class="command-box">
        <h3>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
        <div id="dailyReports">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±...</div>
      </div>
    </div>
  </div>

  <script>
    let currentUser = null;
    let users = JSON.parse(localStorage.getItem('lspd_users')) || [];
    let MASTER_PASSWORD = localStorage.getItem('lspd_master_pass') || "admin2026";
    let messages = JSON.parse(localStorage.getItem('lspd_messages')) || [];
    let cases = JSON.parse(localStorage.getItem('lspd_cases')) || [];
    let officers = JSON.parse(localStorage.getItem('lspd_officers')) || 
      [{name:'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', rank:'Ø¶Ø§Ø¨Ø·', points:15}, {name:'Ø®Ø§Ù„Ø¯ Ø¹Ù„ÙŠ', rank:'Ø¹Ø±ÙŠÙ', points:28}];
    let secretMessages = JSON.parse(localStorage.getItem('lspd_secret')) || [];
    let tasks = JSON.parse(localStorage.getItem('lspd_tasks')) || [];

    const loginBox = document.getElementById('loginBox');
    const adminPanel = document.getElementById('adminPanel');
    const dashboard = document.getElementById('dashboard');
    const username = document.getElementById('username');
    const password = document.getElementById('password');
    const error = document.getElementById('error');
    const userInfo = document.getElementById('userInfo');

    function saveData(key, data) { localStorage.setItem(key, JSON.stringify(data)); }

    document.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        if (document.getElementById('chatInput') === document.activeElement) sendMessage();
        else if (document.getElementById('loginBox').contains(document.activeElement)) login();
      }
    });

    // Admin Functions
    function updateRanksDisplay() {
      const ranksDiv = document.getElementById('currentRanks');
      if (users.length === 0) { ranksDiv.innerHTML = '<em>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ø¹Ø¯</em>'; return; }
      const ranks = [...new Set(users.map(u => u.rank))];
      ranksDiv.innerHTML = ranks.map(r => `<div class="rank-item">ğŸ‘‘ ${r}</div>`).join('');
    }

    function updateMasterDisplay() {
      document.getElementById('currentMasterDisplay').textContent = '*'.repeat(MASTER_PASSWORD.length);
    }

    function addUser() {
      const newUser = document.getElementById('newUsername').value.trim();
      const newPass = document.getElementById('newPassword').value.trim();
      const newRank = document.getElementById('newRank').value.trim();
      if (!newUser || !newPass || !newRank) { alert('âš ï¸ ÙŠØ¬Ø¨ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return; }
      
      let access = [];
      const rankLower = newRank.toLowerCase();
      if (['minister','ÙˆØ²ÙŠØ±'].some(r => rankLower.includes(r))) access = ['view1','view2','view3'];
      else if (['colonel','ÙƒÙˆÙ„ÙˆÙ†ÙŠÙ„','captain','Ù‚Ø§Ø¦Ø¯'].some(r => rankLower.includes(r))) access = ['view1','view2'];
      else access = ['view1'];
      
      users.push({username: newUser, password: newPass, rank: newRank, access});
      saveData('lspd_users', users);
      updateRanksDisplay();
      alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ${newUser} - ${newRank}`);
      document.getElementById('newUsername').value = ''; 
      document.getElementById('newPassword').value = ''; 
      document.getElementById('newRank').value = '';
    }

    function loadUsers() {
      const textarea = document.getElementById('allUsers');
      try {
        const newUsers = JSON.parse(textarea.value);
        if (Array.isArray(newUsers)) {
          users = newUsers;
          saveData('lspd_users', users);
          updateRanksDisplay();
          alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª');
        } else alert('âŒ ØªÙ†Ø³ÙŠÙ‚ JSON ØºÙŠØ± ØµØ­ÙŠØ­');
      } catch(e) { alert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ JSON'); }
    }

    function clearAllUsers() {
      if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª!')) {
        users = [];
        saveData('lspd_users', users);
        updateRanksDisplay();
        alert('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª');
      }
    }

    function showAllUsers() {
      if (users.length === 0) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª');
      const list = users.map((u,i) => `${i+1}. ${u.username} | ${u.rank} | ${u.access.join(', ')}`).join('\n');
      alert(`Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:\n\n${list}`);
    }

    function changeMasterPassword() {
      const currentPass = document.getElementById('currentMasterPass').value;
      const newPass = document.getElementById('newMasterPass').value;
      
      if (currentPass !== MASTER_PASSWORD) {
        alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø®Ø§Ø·Ø¦Ø©');
        return;
      }
      
      if (!newPass || newPass.length < 4) {
        alert('âš ï¸ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø© Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ (4 Ø£Ø­Ø±Ù ÙƒØ­Ø¯ Ø£Ø¯Ù†Ù‰)');
        return;
      }
      
      MASTER_PASSWORD = newPass;
      localStorage.setItem('lspd_master_pass', MASTER_PASSWORD);
      updateMasterDisplay();
      alert('ğŸ”‘ âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!');
      document.getElementById('currentMasterPass').value = '';
      document.getElementById('newMasterPass').value = '';
    }

    // Login Function
    function login() {
      const u = username.value.trim();
      const p = password.value.trim();
      error.textContent = '';

      if (!u || !p) { 
        error.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ§Ù…Ù„Ø©'; 
        return; 
      }

      // Admin Login
      if (u === 'admin' && p === MASTER_PASSWORD) {
        loginBox.classList.add('hidden');
        adminPanel.classList.remove('hidden');
        updateRanksDisplay();
        updateMasterDisplay();
        return;
      }

      // Normal User Login
      const user = users.find(x => x.username === u && x.password === p);
      if (!user) {
        error.textContent = 'âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
        password.value = '';
        password.focus();
        return;
      }

      currentUser = user;
      userInfo.innerHTML = `ğŸ‘‘ ${user.rank} | ${user.username}`;
      loginBox.classList.add('hidden');
      dashboard.classList.remove('hidden');
      username.value = ''; password.value = '';
    }

    // View Functions
    function openView(viewId) {
      if (!currentUser || !currentUser.access.includes(viewId)) {
        alert(`âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„\nØ±ØªØ¨Ø©Ùƒ: ${currentUser ? currentUser.rank : 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'}`);
        return;
      }
      document.querySelectorAll('.view, .dashboard').forEach(v => v.classList.add('hidden'));
      document.getElementById(viewId).classList.remove('hidden');
      
      if (viewId === 'view1') { loadMessages(); loadCases(); }
      if (viewId === 'view2') { loadOfficersTable(); }
      if (viewId === 'view3') { loadSecretChat(); loadTasks(); }
    }

    function back() {
      document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
      dashboard.classList.remove('hidden');
    }

    function backToLogin() {
      document.querySelectorAll('.admin-panel, .dashboard, .view').forEach(v => v.classList.add('hidden'));
      loginBox.classList.remove('hidden');
      currentUser = null;
      username.focus();
    }

    // Chat Functions (View1)
    function sendMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message || !currentUser) return;

      messages.push({
        user: currentUser.username,
        rank: currentUser.rank,
        message,
        time: new Date().toLocaleString('ar-SA'),
        type: 'admin'
      });
      
      saveData('lspd_messages', messages);
      input.value = '';
      loadMessages();
      
      cases.push({
        id: Date.now(),
        title: `${currentUser.rank} ${currentUser.username}`,
        type: 'Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©',
        date: new Date().toLocaleDateString('ar-SA'),
        status: 'Ø¬Ø§Ø±ÙŠØ©'
      });
      saveData('lspd_cases', cases);
      loadCases();
    }

    function loadMessages() {
      const chat = document.getElementById('chatMessages');
      chat.innerHTML = messages.map(msg => 
        `<div class="message ${msg.type}">
          <strong>${msg.rank} ${msg.user}</strong> 
          <small style="float:left; opacity:0.7;">${msg.time}</small><br>
          ${msg.message}
        </div>`
      ).join('');
      chat.scrollTop = chat.scrollHeight;
    }

    function loadCases() {
      const casesList = document.getElementById('casesList');
      casesList.innerHTML = cases.map(c => 
        `<div class="case-item">
          <strong>${c.title}</strong><br>
          <small>Ù†ÙˆØ¹: ${c.type} | ${c.date} | ${c.status}</small>
        </div>`
      ).join('');
    }

    // Officers Table (View2)
    function loadOfficersTable() {
      const table = document.getElementById('officersTable');
      table.innerHTML = officers.map(o => 
        `<tr>
          <td>${o.name}</td>
          <td>${o.rank}</td>
          <td>${o.points}</td>
          <td><button class="points-btn" onclick="addPoints('${o.name}')">+10 Ù†Ù‚Ø§Ø·</button></td>
        </tr>`
      ).join('');
    }

    function addPoints(name) {
      const officer = officers.find(o => o.name === name);
      if (officer) {
        officer.points += 10;
        saveData('lspd_officers', officers);
        loadOfficersTable();
        alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© 10 Ù†Ù‚Ø§Ø· Ù„Ù€ ${name}`);
      }
    }

    // High Command Functions (View3)
    function loadSecretChat() {
      document.getElementById('secretChat').innerHTML = secretMessages.map(m => 
        `<div style="background:rgba(255,0,0,0.2); padding:8px; margin:5px 0; border-radius:8px;">
          ${m.time}: ${m.message}
        </div>`
      ).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§Ù‚Ø´Ø§Øª Ø³Ø±ÙŠØ©';
    }

    function addSecretMessage() {
      const input = document.getElementById('secretInput');
      const message = input.value.trim();
      if (!message || !currentUser) return;
      
      secretMessages.push({
        message,
        time: new Date().toLocaleTimeString('ar-SA'),
        user: currentUser.rank
      });
      saveData('lspd_secret', secretMessages);
      input.value = '';
      loadSecretChat();
    }

    function loadTasks() {
      document.getElementById('urgentTasks').innerHTML = tasks.map(t => 
        `<div style="background:rgba(255,255,0,0.2); padding:8px; margin:5px 0; border-radius:8px;">
          â€¢ ${t}
        </div>`
      ).join('') || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¹Ø§Ø¬Ù„Ø©';
    }

    function addTask() {
      const input = document.getElementById('newTask');
      const task = input.value.trim();
      if (!task) return;
      
      tasks.push(task);
      saveData('lspd_tasks', tasks);
      input.value = '';
      loadTasks();
      alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©');
    }

    // Initialize
    updateRanksDisplay();
    updateMasterDisplay();
    setTimeout(() => { if (error.textContent) error.textContent = ''; }, 5000);
  </script>
</body>
</html>
